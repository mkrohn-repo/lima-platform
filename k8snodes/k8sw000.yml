# Lima configuration (k8sp000)
vmType: vz            # use "qemu" if your host can't use Apple Virtualization
cpus: 2
memory: 2GiB
disk: 20GiB

images:
  - location: "https://cloud-images.ubuntu.com/noble/current/noble-server-cloudimg-arm64.img"
    arch: "aarch64"
  # If there is a local copy  and you wish to use it
  # - location: "file:///Users/USERNAME/path/to/noble-server-cloudimg-arm64.img"

networks:
  - lima: shared
    macAddress: "de:ad:be:ef:00:02"
ssh:
  loadDotSSHPubKeys: true    

provision:
  - mode: system
    script: |
      #!/bin/bash
      set -eux
      NODE_NAME="${NODE_NAME:-k8sw000}"
      apt-get update
      apt-get install -y qemu-guest-agent openssh-server curl ca-certificates net-tools
      apt-get full-upgrade -y
      systemctl enable --now ssh || systemctl enable --now sshd || true
      hostnamectl set-hostname "$NODE_NAME"
      grep -q '192\.168\.105\.102 k8sw000' /etc/hosts || cat >> /etc/hosts <<EOF
      192.168.105.101 k8sp000
      192.168.105.102 k8sw000
      192.168.105.103 k8sw001
      EOF   